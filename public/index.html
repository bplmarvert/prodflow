<html>
    <head>
        <link rel="stylesheet" href="/css/style.css" />
    </head>
    <body>
        <link rel="shortcut icon" href="#" />
        <h1>Projet</h1>
        <h2>système de suivi des lignes de production</h2>
        <div id="app"> </div>  

        <!-- Ajout d'une ligne de production -->

        <div id = 'divajout' 'http://localhost:3000/new-production-line'>
            <form id="ajout"> <!--</form> action="/new-production-line/" method = "POST"> -->
                <label for="nom"> Ligne à ajouter: </label>
                <input type="text" id="nom" name="nom" />  
                <div class = "button">
                    <button type="submit"> OK pour ajout</button>
                </div>                 
            </form>
        </div>

        <!-- Modification du nombre de comprimés d'une ligne de production -->

        <!-- <div id = 'modif' 'http://localhost:3000/production-line/update'>
            <form id="modif"> --><!--</form> action="/new-production-line/" method = "POST"> -->
                <!--<label for="nbli">  No de la ligne: </label> -->
        <!--        <p id="pnbli">  No de la ligne: </p>
                <label for="nbcp">  Nombre de comprimés: </label>
                <input type="text" id="nbcp" name="nbcp" />  
                <div class = "button">
                    <button type="submit"> Poster la modif </button>
                </div>                 
            </form>
        </div>-->


        <script>

            // Affichage de l'information d'un site

            function ShowSiteData(siteInfo){
                //return '<ul><li>' + siteData.firstname + "</li></ul>" + 
                let nb = siteInfo.lignes.length;
                let obj = siteInfo.lignes
                let lines = obj.map(forMap).join("")  // tableau à transformer en texte
                console.log(lines)
                return `<ul>
                    <li>Site de: ${siteInfo.nom}</li>
                    <li>Adresse: ${siteInfo.adresse.rue} ${siteInfo.adresse.ville}</li>
                    ${lines}
                 </ul>`
            }

            function forMap(obj){
                return `<li>Line ${obj.nom}       comprimés fabriqués: ${obj.nbProduits}</li>`
            }

            // Sélection des lignes d'un site

            function selectTheLine(siteInfo){
                let nb = siteInfo.lignes.length;
                let obj = siteInfo.lignes
                let lines = obj.map(forMap1).join("")  // tableau à transformer en texte
                console.log(lines)
                return `<p> Choix de la ligne sur laquelle modifier le nombre de comprimés: </p>
                    <SELECT id='nbli' NAME="listline">
                        ${lines}
                    </SELECT>`
            }

            /*function forMap1(obj){
                return `<OPTION value="line ${obj.nom} ${obj.nom     comprimés fabriqués: ${obj.nbProduits}>`
            }*/

            function addHtmlToElement(html, elementSelector){

                let element = document.querySelector(elementSelector)
                element.innerHTML = html
            }

            //send a request to get Site data from the server
            let promise = fetch("/site-info/") //async func

            promise.then(response => { //response from server
                return response.json()
            }).then(siteInfo =>{ 
                console.log(siteInfo.lignes)
                let html = ShowSiteData(siteInfo)  // pour l'affichage des infos
                addHtmlToElement(html, "#app")
     /*           let html1 = selectTheLine(siteInfo) // pour la liste de sélection
                addHtmlToElement(html1,"#nbli") */
            })

            // ajout d'une ligne 
            let url = 'http://localhost:3000/new-production-line'
            document.querySelector("#divajout").addEventListener("submit", event => { 
                    event.preventDefault()
                let nom = document.getElementById("nom").value 
                console.log ("nom : ", nom)
                const response = fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({'nom': nom}) // body data type must match "Content-Type" header
                });
                return response.JSON;
            })

            // modification du nombre de cp
            /*let url1 = 'http://localhost:3000/production-line/update'
            document.querySelector("#modif").addEventListener("submit", event => { 
                event.preventDefault()
            let nom = document.getElementById("nbli").value 
            let nbcp = document.getElementById("nbcp").value 
            console.log ("nom ligne update : ", nom)
            console.log ("nbcp : ", nbcp)
            const response = fetch(url1, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({'nom': nom, 'nbProduits': nbcp})
            });
            //return response.JSON;
        })*/

        </script>
    </body>
</html>
<!--<html>
    <body>
        <script>
            function addToPage(userData){
                //1.utiliser les données pour générer du html
                let html = `<p>${userData.firstname} - ${userData.age}`
                
                //2. Ajouter le html à la page
                //document.createElement
                let div = document.createElement("div")
                //3. innerHtml
                div.innerHTML = html
                let body = document.querySelector("body")    
                //4. append
                body.appendChild(div)
                //document.body.append(div)
            }

            fetch('/user')
                .then(response => response.json())
                .then(addToPage)
        </script>
    </body>
</html> -->